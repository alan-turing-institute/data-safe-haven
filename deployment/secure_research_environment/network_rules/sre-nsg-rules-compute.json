[
    {
        "name": "AllowNTPOutbound",
        "access": "Allow",
        "description": "Allow outbound connections to external NTP servers",
        "destinationAddressPrefix": [
            {{#shm.time.ntp.serverAddresses}}
                "{{.}}",
            {{/shm.time.ntp.serverAddresses}}
        ],
        "destinationPortRange": 123,
        "direction": "Outbound",
        "priority": 1000,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowClamAVOutbound",
        "access": "Allow",
        "description": "Allow outbound connections to external ClamAV servers",
        "destinationAddressPrefix": "104.16.219.84",
        "destinationPortRange": [53, 443],
        "direction": "Outbound",
        "priority": 1100,
        "protocol": "TCP",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowLDAPOutbound",
        "access": "Allow",
        "description": "Allow outbound LDAP connections to the SHM DC",
        "destinationAddressPrefix": "{{shm.network.vnet.subnets.identity.cidr}}",
        "destinationPortRange": [389, 636, 3268, 3269],
        "direction": "Outbound",
        "priority": 2000,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowDNSOutbound",
        "access": "Allow",
        "description": "Allow outbound DNS connections to the SHM DC",
        "destinationAddressPrefix": "{{shm.network.vnet.subnets.identity.cidr}}",
        "destinationPortRange": 53,
        "direction": "Outbound",
        "priority": 2100,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowKerberosOutbound",
        "access": "Allow",
        "description": "Allow outbound Kerberos connections to the SHM DC",
        "destinationAddressPrefix": "{{shm.network.vnet.subnets.identity.cidr}}",
        "destinationPortRange": [88, 464],
        "direction": "Outbound",
        "priority": 2200,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowDomainJoinOutbound",
        "access": "Allow",
        "description": "Allow outbound RPC/NetBIOS/NetLogon/SMB connections for domain joining to the SHM DC",
        "destinationAddressPrefix": "{{shm.network.vnet.subnets.identity.cidr}}",
        "destinationPortRange": ["135", "445", "49152-65535"],
        "direction": "Outbound",
        "priority": 2300,
        "protocol": "TCP",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowPrivateDataEndpointsOutbound",
        "access": "Allow",
        "description": "Allow outbound connections to private endpoints in the VNet",
        "destinationAddressPrefix": "{{sre.network.vnet.subnets.data.cidr}}",
        "destinationPortRange": "*",
        "direction": "Outbound",
        "priority": 3000,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowDatabasesOutbound",
        "access": "Allow",
        "description": "Allow outbound connections to the database subnet",
        "destinationAddressPrefix": "{{sre.network.vnet.subnets.databases.cidr}}",
        "destinationPortRange": "*",
        "direction": "Outbound",
        "priority": 3100,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowWebappsOutbound",
        "access": "Allow",
        "description": "Allow outbound http(s) connections to the webapps subnet",
        "destinationAddressPrefix": "{{sre.network.vnet.subnets.webapps.cidr}}",
        "destinationPortRange": ["80", "443"],
        "direction": "Outbound",
        "priority": 3200,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "AllowVirtualNetworkOutbound",
        "access": "Allow",
        "description": "Allow other outbound traffic to the virtual network.",
        "destinationAddressPrefix": "VirtualNetwork",
        "destinationPortRange": "*",
        "direction": "Outbound",
        "priority": 3500,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "{{sre.rds.gateway.networkRules.outboundInternet}}InternetOutbound",
        "access": "{{sre.rds.gateway.networkRules.outboundInternet}}",
        "description": "{{sre.rds.gateway.networkRules.outboundInternet}} outbound connections to internet",
        "destinationAddressPrefix": "Internet",
        "destinationPortRange": "*",
        "direction": "Outbound",
        "priority": 4000,
        "protocol": "*",
        "sourceAddressPrefix": "{{sre.network.vnet.subnets.compute.cidr}}",
        "sourcePortRange": "*"
    },
    {
        "name": "{{sre.rds.gateway.networkRules.outboundInternet}}AzurePlatformDnsOutbound",
        "access": "{{sre.rds.gateway.networkRules.outboundInternet}}",
        "description": "{{sre.rds.gateway.networkRules.outboundInternet}} outbound connections to Azure Platform DNS endpoints (including 168.63.129.16), which are not included in the 'Internet' service tag.",
        "destinationAddressPrefix": "AzurePlatformDNS",
        "destinationPortRange": "*",
        "direction": "Outbound",
        "priority": 4001,
        "protocol": "*",
        "sourceAddressPrefix": "*",
        "sourcePortRange": "*"
    },
    {
        "name": "DenyAllOtherOutbound",
        "access": "Deny",
        "description": "Deny all other outbound traffic.",
        "destinationAddressPrefix": "*",
        "destinationPortRange": "*",
        "direction": "Outbound",
        "priority": 4096,
        "protocol": "*",
        "sourceAddressPrefix": "*",
        "sourcePortRange": "*"
    }
]
